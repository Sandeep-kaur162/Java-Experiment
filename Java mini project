import java.util.*;

class Student {
    private int id;
    private String name;
    private String email;
    private double feeBalance;

    public Student(int id, String name, String email, double feeBalance) {
        this.id = id;
        this.name = name;
        this.email = email;
        this.feeBalance = feeBalance;
    }

    public int getId() { return id; }
    public String getName() { return name; }
    public void setName(String name) { this.name = name; }
    public String getEmail() { return email; }
    public void setEmail(String email) { this.email = email; }
    public double getFeeBalance() { return feeBalance; }
    public void setFeeBalance(double feeBalance) { this.feeBalance = feeBalance; }

    @Override
    public String toString() {
        return "ID: " + id + ", Name: " + name + ", Email: " + email + ", Fee Balance: " + feeBalance;
    }
}

class Course {
    private int id;
    private String name;
    private double fee;

    public Course(int id, String name, double fee) {
        this.id = id;
        this.name = name;
        this.fee = fee;
    }

    public int getId() { return id; }
    public String getName() { return name; }
    public double getFee() { return fee; }

    @Override
    public String toString() {
        return "ID: " + id + ", Course: " + name + ", Fee: " + fee;
    }
}

class StudentService {
    private Map<Integer, Student> students = new HashMap<>();
    private Map<Integer, Course> courses = new HashMap<>();
    private int studentIdCounter = 1;
    private int courseIdCounter = 1;

    // Dependency Injection simulation (constructor injection)
    public StudentService() {
        // Initialize some courses
        addCourse("BCA", 5000);
        addCourse("MCA", 10000);
    }

    // Student CRUD
    public void addStudent(String name, String email) {
        Student s = new Student(studentIdCounter++, name, email, 0);
        students.put(s.getId(), s);
        System.out.println("Added student: " + s);
    }

    public void viewStudents() {
        if (students.isEmpty()) {
            System.out.println("No students found.");
            return;
        }
        students.values().forEach(System.out::println);
    }

    public void updateStudent(int id, String newName, String newEmail) {
        Student s = students.get(id);
        if (s != null) {
            s.setName(newName);
            s.setEmail(newEmail);
            System.out.println("Updated student: " + s);
        } else {
            System.out.println("Student ID not found.");
        }
    }

    public void deleteStudent(int id) {
        Student removed = students.remove(id);
        if (removed != null) {
            System.out.println("Deleted student: " + removed);
        } else {
            System.out.println("Student ID not found.");
        }
    }

    // Course management
    public void addCourse(String name, double fee) {
        Course c = new Course(courseIdCounter++, name, fee);
        courses.put(c.getId(), c);
    }

    public void viewCourses() {
        courses.values().forEach(System.out::println);
    }

    // Transaction management simulation
    public void payFee(int studentId, int courseId) {
        Student s = students.get(studentId);
        Course c = courses.get(courseId);
        if (s == null || c == null) {
            System.out.println("Invalid student or course ID.");
            return;
        }

        double originalBalance = s.getFeeBalance();
        try {
            // Simulate payment
            s.setFeeBalance(s.getFeeBalance() + c.getFee());
            System.out.println("Payment successful! Updated student: " + s);

        } catch (Exception e) {
            // Rollback
            s.setFeeBalance(originalBalance);
            System.out.println("Payment failed. Transaction rolled back.");
        }
    }

    public void refundFee(int studentId, int courseId) {
        Student s = students.get(studentId);
        Course c = courses.get(courseId);
        if (s == null || c == null) {
            System.out.println("Invalid student or course ID.");
            return;
        }

        double originalBalance = s.getFeeBalance();
        try {
            if (s.getFeeBalance() < c.getFee()) {
                throw new Exception("Insufficient balance to refund.");
            }
            s.setFeeBalance(s.getFeeBalance() - c.getFee());
            System.out.println("Refund successful! Updated student: " + s);

        } catch (Exception e) {
            s.setFeeBalance(originalBalance);
            System.out.println("Refund failed. Transaction rolled back.");
        }
    }
}

public class OnlineStudentManagementConsole {
    private static Scanner sc = new Scanner(System.in);

    public static void main(String[] args) {
        StudentService service = new StudentService();

        while (true) {
            System.out.println("\n--- Online Student Management ---");
            System.out.println("1. Add Student");
            System.out.println("2. View Students");
            System.out.println("3. Update Student");
            System.out.println("4. Delete Student");
            System.out.println("5. View Courses");
            System.out.println("6. Pay Fee");
            System.out.println("7. Refund Fee");
            System.out.println("8. Exit");
            System.out.print("Choose an option: ");
            int choice = sc.nextInt();
            sc.nextLine(); // consume newline

            switch (choice) {
                case 1 -> {
                    System.out.print("Enter name: ");
                    String name = sc.nextLine();
                    System.out.print("Enter email: ");
                    String email = sc.nextLine();
                    service.addStudent(name, email);
                }
                case 2 -> service.viewStudents();
                case 3 -> {
                    System.out.print("Enter student ID: ");
                    int id = sc.nextInt(); sc.nextLine();
                    System.out.print("Enter new name: ");
                    String newName = sc.nextLine();
                    System.out.print("Enter new email: ");
                    String newEmail = sc.nextLine();
                    service.updateStudent(id, newName, newEmail);
                }
                case 4 -> {
                    System.out.print("Enter student ID: ");
                    int id = sc.nextInt(); sc.nextLine();
                    service.deleteStudent(id);
                }
                case 5 -> service.viewCourses();
                case 6 -> {
                    System.out.print("Enter student ID: ");
                    int sid = sc.nextInt();
                    System.out.print("Enter course ID: ");
                    int cid = sc.nextInt();
                    service.payFee(sid, cid);
                }
                case 7 -> {
                    System.out.print("Enter student ID: ");
                    int sid = sc.nextInt();
                    System.out.print("Enter course ID: ");
                    int cid = sc.nextInt();
                    service.refundFee(sid, cid);
                }
                case 8 -> {
                    System.out.println("Exiting...");
                    return;
                }
                default -> System.out.println("Invalid choice. Try again.");
            }
        }
    }
}
